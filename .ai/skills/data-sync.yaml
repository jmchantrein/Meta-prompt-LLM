# Data-sync skill
# ============================================================================
# Synchronizes data/ to project files and validates integrity
# ============================================================================

name: "data-sync"
version: "1.0.0"
description: "Synchronizes data/ to project files and validates integrity"

author: "Meta-prompt-LLM"
created: "2026-02-01"
updated: "2026-02-01"

category: "core"
tags:
  - "sync"
  - "integrity"
  - "hash"
  - "version"
  - "core"

# ----------------------------------------------------------------------------
# ACTIVATION
# ----------------------------------------------------------------------------
triggers:
  patterns:
    - "prompts/fr/metametaprompts/data/**/*.yaml"
    - "prompts/fr/metametaprompts/data/**/*.md"
  keywords:
    - "data-sync"
    - "sync"
    - "integrity"
    - "hash check"
  commands:
    - "/data-sync"
    - "/sync"
    - "/integrity-check"
  automatic: true   # Runs at session start

# ----------------------------------------------------------------------------
# CONTEXT
# ----------------------------------------------------------------------------
context:
  files:
    - "prompts/fr/metametaprompts/data/manifest.yaml"
    - "prompts/fr/metametaprompts/data/registries.yaml"
    - "prompts/fr/metametaprompts/data/rules/rules.yaml"
    - "prompts/fr/metametaprompts/data/skills/internal/*.yaml"
    - "prompts/fr/metametaprompts/data/skills/external/*.yaml"
    - "prompts/fr/metametaprompts/data/hooks/internal/*.yaml"
    - "prompts/fr/metametaprompts/data/hooks/external/*.yaml"
    - "prompts/fr/metametaprompts/data/commands/internal/*.yaml"
    - "prompts/fr/metametaprompts/data/commands/external/*.yaml"
    - "prompts/fr/metametaprompts/data/prompts/**/*.md"
  outputs:
    - ".ai/skills/*.yaml"  # Flattened from internal/ + external/
    - ".ai/hooks/*.yaml"
    - ".ai/commands/*.yaml"
    - "AGENTS.md"
  dependencies:
    - "memory-keeper"

# ----------------------------------------------------------------------------
# INSTRUCTIONS
# ----------------------------------------------------------------------------
instructions:
  role: |
    Tu es l'agent responsable de la synchronisation des donn√©es
    et de l'int√©grit√© du projet Meta-prompt-LLM.

    ## Source de v√©rit√©

    `prompts/fr/metametaprompts/data/` est la source unique de v√©rit√© pour :
    - R√®gles (data/rules/rules.yaml)
    - Skills internes (data/skills/internal/*.yaml)
    - Skills externes (data/skills/external/*.yaml) - install√©s via package-manager
    - Hooks internes (data/hooks/internal/*.yaml)
    - Hooks externes (data/hooks/external/*.yaml)
    - Commands internes (data/commands/internal/*.yaml)
    - Commands externes (data/commands/external/*.yaml)
    - Registries (data/registries.yaml) - sources externes (Vercel, Antigravity, etc.)
    - Prompts (data/prompts/**/*.md)

    ## Fichiers g√©n√©r√©s (outputs)

    - `.ai/skills/*.yaml` : Aplati depuis data/skills/internal/ + external/
    - `.ai/hooks/*.yaml` : Aplati depuis data/hooks/internal/ + external/
    - `.ai/commands/*.yaml` : Aplati depuis data/commands/internal/ + external/
    - `AGENTS.md` : G√©n√©r√© depuis data/rules/ et data/skills/ (via generate.sh)

  guidelines:
    - "TOUJOURS v√©rifier l'int√©grit√© avant synchronisation"
    - "TOUJOURS proposer avant de synchroniser"
    - "TOUJOURS mettre √† jour le manifest apr√®s modification"
    - "TOUJOURS utiliser le versioning s√©mantique"

  process: |
    ## Processus au d√©but de session

    ### 1. V√©rification d'int√©grit√©

    ```bash
    cd prompts/fr/metametaprompts/data
    sha256sum rules/rules.yaml skills/*.yaml
    ```

    Comparer avec les hash stock√©s dans manifest.yaml.

    ### 2. Si changements d√©tect√©s

    ```
    üîÑ Changements d√©tect√©s dans data/

    | Fichier | Action requise |
    |---------|----------------|
    | data/skills/new-skill.yaml | Nouveau fichier |
    | data/rules/rules.yaml | Hash modifi√© |

    Actions propos√©es :
    1. Recalculer les hash dans manifest.yaml
    2. Incr√©menter les versions concern√©es
    3. Synchroniser vers .ai/skills/

    Proc√©der ? [Oui / Non / D√©tails]
    ```

    ### 3. Synchronisation (si valid√©)

    1. **Skills** : Flatten internal + external ‚Üí .ai/skills/*.yaml
       - data/skills/internal/*.yaml ‚Üí .ai/skills/*.yaml
       - data/skills/external/*.yaml ‚Üí .ai/skills/*.yaml
    2. **Hooks** : Flatten internal + external ‚Üí .ai/hooks/*.yaml
    3. **Commands** : Flatten internal + external ‚Üí .ai/commands/*.yaml
    4. **Rules** : Ex√©cuter generate.sh pour r√©g√©n√©rer AGENTS.md
    5. **Manifest** : Mettre √† jour hash et timestamps

    ### 4. Versioning automatique

    R√®gles de bump de version :
    - Nouveau fichier : 1.0.0
    - Hash chang√© (contenu modifi√©) : bump patch (1.0.0 ‚Üí 1.0.1)
    - Structure chang√©e : bump minor (1.0.0 ‚Üí 1.1.0)
    - Breaking change : bump major (manuel)

  output_format: |
    ## Rapport de synchronisation

    ```
    ‚úÖ Synchronisation data-sync termin√©e

    ### Fichiers v√©rifi√©s
    - data/rules/rules.yaml: ‚úÖ Int√®gre
    - data/skills/*.yaml: ‚úÖ Int√®gre (7 fichiers)

    ### Actions effectu√©es
    - [x] Int√©grit√© v√©rifi√©e
    - [x] Aucun changement d√©tect√©

    ### Statut
    ‚úÖ Session normale
    ```

# ----------------------------------------------------------------------------
# CONSTRAINTS
# ----------------------------------------------------------------------------
constraints:
  must:
    - "TOUJOURS v√©rifier l'int√©grit√© avant synchronisation"
    - "TOUJOURS proposer avant de synchroniser"
    - "TOUJOURS mettre √† jour le manifest apr√®s modification"
    - "TOUJOURS utiliser le versioning s√©mantique"
  must_not:
    - "JAMAIS modifier data/ sans validation utilisateur¬∑ice"
    - "JAMAIS √©craser des modifications locales sans confirmation"
    - "JAMAIS synchroniser si les hash ne sont pas v√©rifi√©s"
  assumptions:
    - "data/ contient la source de v√©rit√©"
    - "manifest.yaml contient les hash de r√©f√©rence"

# ----------------------------------------------------------------------------
# SECURITY
# ----------------------------------------------------------------------------
security:
  never:
    - "Modifier data/ sans validation utilisateur¬∑ice"
    - "Ignorer les diff√©rences de hash"
  always:
    - "Proposer avant d'agir"
    - "V√©rifier l'int√©grit√©"

# ----------------------------------------------------------------------------
# PLATFORM-SPECIFIC
# ----------------------------------------------------------------------------
platforms:
  claude:
    model: "claude-sonnet-4-20250514"
    temperature: 0.2
    tools:
      - "read_file"
      - "write_file"
      - "bash"
      - "glob"

# ----------------------------------------------------------------------------
# METADATA
# ----------------------------------------------------------------------------
meta:
  changelog:
    - version: "1.0.0"
      date: "2026-02-01"
      changes:
        - "Version initiale"
        - "V√©rification d'int√©grit√© par hash"
        - "Synchronisation data/ ‚Üí .ai/skills/"
  related_skills:
    - "memory-keeper"
    - "self-improver"
    - "workflow-orchestrator"
  documentation: "docs/en/specs/version-check-system.md"
