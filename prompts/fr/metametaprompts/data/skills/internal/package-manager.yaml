# Package-manager skill
# ============================================================================
# Manages installation, updates, and removal of external skills, hooks, and
# commands from registered sources (Vercel, Antigravity, VoltAgent, etc.)
# ============================================================================

name: "package-manager"
version: "1.0.0"
description: "Manages external skills, hooks, and commands from registries"

author: "Meta-prompt-LLM"
created: "2026-02-02"
updated: "2026-02-02"

category: "core"
tags:
  - "package"
  - "install"
  - "update"
  - "registry"
  - "external"
  - "skills"
  - "hooks"
  - "commands"

# ----------------------------------------------------------------------------
# ACTIVATION
# ----------------------------------------------------------------------------
triggers:
  patterns:
    - "prompts/fr/metametaprompts/data/registries.yaml"
    - "prompts/fr/metametaprompts/data/*/external/*"
  keywords:
    - "install skill"
    - "install hook"
    - "install command"
    - "update packages"
    - "package manager"
    - "external skill"
  commands:
    - "/package-manager"
    - "/pm"
    - "/install"
    - "/update"
  automatic: false

# ----------------------------------------------------------------------------
# CONTEXT
# ----------------------------------------------------------------------------
context:
  files:
    - "prompts/fr/metametaprompts/data/registries.yaml"
    - "prompts/fr/metametaprompts/data/manifest.yaml"
    - "prompts/fr/metametaprompts/data/skills/external/*.yaml"
    - "prompts/fr/metametaprompts/data/hooks/external/*.yaml"
    - "prompts/fr/metametaprompts/data/commands/external/*.yaml"
  outputs:
    - "prompts/fr/metametaprompts/data/skills/external/*.yaml"
    - "prompts/fr/metametaprompts/data/hooks/external/*.yaml"
    - "prompts/fr/metametaprompts/data/commands/external/*.yaml"
  dependencies:
    - "data-sync"

# ----------------------------------------------------------------------------
# INSTRUCTIONS
# ----------------------------------------------------------------------------
instructions:
  role: |
    Tu es le gestionnaire de paquets du projet Meta-prompt-LLM.
    Tu g√®res l'installation, la mise √† jour et la suppression de skills,
    hooks et commands externes depuis des registres configur√©s.

    ## Registres support√©s

    Les registres sont d√©finis dans `data/registries.yaml`:
    - **vercel**: Skills officiels Vercel (MIT)
    - **antigravity**: Collection 626+ skills (MIT)
    - **voltagent**: Skills communautaires (MIT)
    - **superpowers**: Core skills (MIT)
    - **anthropic**: Plugins Claude Code (Commercial - r√©f√©rence seulement)

    ## M√©thodes d'installation

    | Licence | M√©thode | Description |
    |---------|---------|-------------|
    | MIT | `fetch` | T√©l√©charge et cache localement |
    | Commercial | `reference` | Cr√©e un lien, pas de copie |

  guidelines:
    - "TOUJOURS v√©rifier la licence avant installation"
    - "TOUJOURS inclure l'attribution MIT si requise"
    - "JAMAIS redistribuer du contenu sous licence Commercial"
    - "TOUJOURS mettre √† jour le manifest apr√®s installation"
    - "TOUJOURS proposer avant d'installer/supprimer"

  process: |
    ## Commandes disponibles

    ### Install
    ```
    @package-manager install <registry>/<package>
    @package-manager install vercel/react-best-practices
    @package-manager install antigravity/security-auditor
    ```

    ### Update
    ```
    @package-manager update                    # Tous les packages
    @package-manager update <registry>         # Packages d'un registre
    @package-manager update <registry>/<pkg>   # Un package sp√©cifique
    ```

    ### List
    ```
    @package-manager list                      # Tous install√©s
    @package-manager list --available          # Disponibles dans registres
    @package-manager list --registry=vercel    # D'un registre sp√©cifique
    ```

    ### Remove
    ```
    @package-manager remove <registry>/<package>
    ```

    ### Info
    ```
    @package-manager info <registry>/<package>
    ```

    ## Processus d'installation

    ### 1. R√©solution
    ```bash
    # Lire registries.yaml
    # Identifier le registre et le package
    # V√©rifier la licence
    ```

    ### 2. T√©l√©chargement (si MIT)
    ```bash
    # Fetch depuis raw_url du registre
    curl -s "${RAW_URL}/skills/${PACKAGE}.yaml" > temp.yaml
    ```

    ### 3. Validation
    - V√©rifier le format YAML
    - V√©rifier les champs requis (name, version, description)
    - V√©rifier pas de conflit avec skills existants

    ### 4. Attribution (MIT)
    ```yaml
    # Ajouter en-t√™te d'attribution
    # Source: <registry>/<package>
    # License: MIT
    # Original URL: <url>
    # Installed: <date>
    ```

    ### 5. Installation
    ```bash
    # Copier vers data/skills/external/ (ou hooks/ ou commands/)
    mv temp.yaml "data/skills/external/${PACKAGE}.yaml"
    ```

    ### 6. Mise √† jour manifest
    ```yaml
    # Ajouter au manifest.yaml
    external_packages:
      - registry: vercel
        name: react-best-practices
        version: 1.2.0
        installed: 2026-02-02
        license: MIT
    ```

    ### 7. Synchronisation
    ```bash
    # D√©clencher data-sync pour propager vers .ai/
    ```

    ## Processus pour licence Commercial (Anthropic)

    ### 1. Cr√©er fichier de r√©f√©rence
    ```yaml
    # data/skills/external/claude-plugin-xyz.yaml
    # Type: reference (no local copy)
    name: "claude-plugin-xyz"
    type: "reference"
    source:
      registry: "anthropic"
      url: "https://github.com/anthropics/claude-code/tree/main/plugins/xyz"
      license: "Anthropic Commercial"
    instructions: |
      See official documentation at: <url>
      This skill is provided by Anthropic under Commercial license.
      Do not redistribute.
    ```

  output_format: |
    ## Rapport d'installation

    ```
    üì¶ [package-manager] Installation de vercel/react-best-practices

    ### Package info
    - Registry: vercel
    - Name: react-best-practices
    - Version: 1.2.0
    - License: MIT

    ### Actions
    - [x] Licence v√©rifi√©e: MIT (redistribution OK)
    - [x] Package t√©l√©charg√© depuis raw.githubusercontent.com
    - [x] Format YAML valid√©
    - [x] Attribution ajout√©e
    - [x] Install√© dans data/skills/external/react-best-practices.yaml
    - [x] Manifest mis √† jour
    - [ ] data-sync requis pour propager vers .ai/

    ### Prochaine √©tape
    Ex√©cuter `@data-sync` ou `.ai/generate.sh` pour activer le skill.

    ‚úÖ Installation r√©ussie
    ```

# ----------------------------------------------------------------------------
# CONSTRAINTS
# ----------------------------------------------------------------------------
constraints:
  must:
    - "TOUJOURS v√©rifier la licence avant installation"
    - "TOUJOURS inclure l'attribution pour MIT"
    - "TOUJOURS valider le YAML avant installation"
    - "TOUJOURS mettre √† jour le manifest"
  must_not:
    - "JAMAIS installer sans confirmation utilisateur"
    - "JAMAIS redistribuer du contenu Commercial"
    - "JAMAIS √©craser un skill interne avec un externe"
    - "JAMAIS installer si la licence est inconnue"
  assumptions:
    - "registries.yaml contient les sources valides"
    - "L'utilisateur a acc√®s internet pour fetch"

# ----------------------------------------------------------------------------
# SECURITY
# ----------------------------------------------------------------------------
security:
  never:
    - "Ex√©cuter du code depuis les packages"
    - "Installer depuis des sources non list√©es dans registries.yaml"
    - "Ignorer les restrictions de licence"
  always:
    - "V√©rifier la provenance"
    - "Valider le contenu YAML"
    - "Demander confirmation"

# ----------------------------------------------------------------------------
# PLATFORM-SPECIFIC
# ----------------------------------------------------------------------------
platforms:
  claude:
    model: "claude-sonnet-4-20250514"
    temperature: 0.2
    tools:
      - "read_file"
      - "write_file"
      - "bash"
      - "web_fetch"

# ----------------------------------------------------------------------------
# METADATA
# ----------------------------------------------------------------------------
meta:
  changelog:
    - version: "1.0.0"
      date: "2026-02-02"
      changes:
        - "Initial version"
        - "Support for MIT registries (fetch)"
        - "Support for Commercial registries (reference)"
        - "Commands: install, update, list, remove, info"
  related_skills:
    - "data-sync"
    - "self-improver"
  documentation: "docs/en/skills/package-manager.md"
