# Link checker skill
# ============================================================================
# Validates internal links and paths in markdown files.
# Ensures cross-references point to existing files.
# ============================================================================

name: "link-checker"
version: "1.1.0"
description: "Validates internal links and paths in markdown files"

author: "Meta-prompt-LLM"
created: "2026-01-31"
updated: "2026-01-31"

category: "validation"
tags:
  - "validation"
  - "links"
  - "paths"
  - "markdown"
  - "cross-reference"

# ----------------------------------------------------------------------------
# ACTIVATION
# ----------------------------------------------------------------------------
triggers:
  patterns:
    - "**/*.md"
    - "prompts/**/*.md"
    - "docs/**/*.md"
  keywords:
    - "check links"
    - "validate links"
    - "broken links"
    - "link check"
  commands:
    - "/check-links"
    - "/validate-paths"
  automatic: true   # Run before commit via workflow-orchestrator

# ----------------------------------------------------------------------------
# CONTEXT
# ----------------------------------------------------------------------------
context:
  files:
    - "prompts/**/*.md"
    - "docs/**/*.md"
    - "README*.md"
    - "AGENTS.md"
    - "CLAUDE.md"
  dependencies: []

# ----------------------------------------------------------------------------
# INSTRUCTIONS
# ----------------------------------------------------------------------------
instructions:
  role: |
    You are an internal link validator. Your purpose is to ensure all
    relative links and cross-references in markdown files point to
    files that actually exist in the repository.

  guidelines:
    - "Check all relative links in markdown files"
    - "Verify cross-language links (EN/FR) point to existing translations"
    - "Validate prompt cross-references between related prompts"
    - "Ignore external URLs (http://, https://)"
    - "Report broken links with file location and line number"

  process: |
    ## Validation process

    ### 1. Extract internal links
    Find all markdown links matching these patterns:
    - `[text](relative/path.md)`
    - `[text](../path/to/file.md)`
    - `[text](./local-file.md)`

    Ignore:
    - External URLs: `[text](https://...)`
    - Anchors only: `[text](#section)`
    - Empty links: `[text]()`
    - Template placeholders: `[text]([category]/[name].md)`

    ### 2. Resolve paths CAREFULLY
    For each link, follow these steps precisely:

    **Step 2.1**: Get the source file's directory
    Example: `prompts/fr/metaprompts/hybrid-ai-bootstrap/README.md`
    Directory: `prompts/fr/metaprompts/hybrid-ai-bootstrap/`

    **Step 2.2**: Count `../` segments and navigate UP
    - Each `../` goes up ONE directory level
    - `../../` from `prompts/fr/metaprompts/hybrid-ai-bootstrap/` = `prompts/fr/`
    - `../` from `prompts/fr/metaprompts/hybrid-ai-bootstrap/` = `prompts/fr/metaprompts/`

    **Step 2.3**: Append remaining path
    - Link: `../../hybrid-ai-takeover/hybrid-ai-takeover.md`
    - After `../../`: `prompts/fr/`
    - Append rest: `prompts/fr/hybrid-ai-takeover/hybrid-ai-takeover.md`
    - THIS IS WRONG - missing `metaprompts/` category!

    **Step 2.4**: Verify the final resolved path exists
    Use glob or file read to confirm file exists.

    ### 3. Common errors to detect

    **Missing category in prompts path**:
    - WRONG: `prompts/fr/hybrid-ai-takeover/...`
    - RIGHT: `prompts/fr/metaprompts/hybrid-ai-takeover/...`

    **Too many `../` segments**:
    - From `prompts/en/metaprompts/foo/README.md`
    - `../../bar/bar.md` → `prompts/en/bar/bar.md` (skips metaprompts!)
    - `../bar/bar.md` → `prompts/en/metaprompts/bar/bar.md` (correct)

    **Mismatched EN/FR structure**:
    - EN link should match FR structure exactly
    - `../../../fr/metaprompts/foo/foo.md` must exist if linked

    ### 4. Verify existence
    For each resolved path:
    - Use glob to check if file exists
    - Report full resolved path in error message
    - Show both the link AND the resolved target

    ### 5. Special checks for prompts
    For files in `prompts/`:
    - Structure MUST be: `prompts/[lang]/[category]/[name]/[name].md`
    - Cross-language links: `../../../[other-lang]/[category]/[name]/[name].md`
    - Same-category links: `../[name]/[name].md`
    - Verify EN/FR translations exist for each prompt

    ### 6. Generate detailed report

  output_format: |
    ## Output format

    ```
    # Link validation report

    ## Status: [PASS/FAIL]

    ## Summary
    - Files checked: N
    - Links found: N
    - Valid links: N
    - Broken links: N

    ## Broken links

    ### file: prompts/en/metaprompts/example/example.md
    - Line 21: [Version francaise](../../../fr/metaprompts/example/example.md)
      Target does not exist: prompts/fr/metaprompts/example/example.md

    ### file: docs/en/guide.md
    - Line 45: [API reference](./api.md)
      Target does not exist: docs/en/api.md

    ## Warnings

    - prompts/en/metaprompts/old-prompt/old-prompt.md: Missing FR translation

    ## Actions required
    1. Create missing file: prompts/fr/metaprompts/example/example.md
    2. Fix or remove broken link in docs/en/guide.md:45
    ```

  examples:
    - input: |
        Check links in prompts/en/metaprompts/hybrid-ai-bootstrap/hybrid-ai-bootstrap.md
      output: |
        # Link validation report

        ## Status: PASS

        ## Summary
        - Files checked: 1
        - Links found: 2
        - Valid links: 2
        - Broken links: 0

        ## Links validated
        - Line 21: [Version francaise](../../../fr/metaprompts/hybrid-ai-bootstrap/hybrid-ai-bootstrap.md) -> OK
        - Line 312: [hybrid-ai-takeover](../hybrid-ai-takeover/hybrid-ai-takeover.md) -> OK
      explanation: "All links in the file point to existing targets"

# ----------------------------------------------------------------------------
# LINK PATTERNS
# ----------------------------------------------------------------------------
patterns:
  # Markdown link regex
  markdown_link: '\[([^\]]+)\]\(([^)]+)\)'

  # Internal link (not starting with http/https/mailto/#)
  internal_link: '^(?!https?://|mailto:|#).*'

  # Cross-language link patterns
  en_to_fr: '../../../fr/'
  fr_to_en: '../../../en/'

# ----------------------------------------------------------------------------
# CONSTRAINTS
# ----------------------------------------------------------------------------
constraints:
  must:
    - "Check all .md files in scope"
    - "Resolve relative paths STEP BY STEP from source file location"
    - "Count each ../ segment individually when navigating up"
    - "Report line numbers for broken links"
    - "Show both the link text AND the resolved absolute path"
    - "Verify resolved paths exist using glob"
    - "Distinguish between missing files and missing translations"
  must_not:
    - "Never validate external URLs (not in scope)"
    - "Never auto-fix links without explicit request"
    - "Never ignore cross-language links"
    - "Never skip path resolution verification"
    - "Never assume a path is correct without checking file exists"
  assumptions:
    - "All internal links use relative paths"
    - "Prompt structure follows prompts/[lang]/[category]/[name]/[name].md"
    - "Doc structure follows docs/[lang]/*.md"
    - "Category directory is ALWAYS required in prompts paths"

# ----------------------------------------------------------------------------
# PLATFORM-SPECIFIC
# ----------------------------------------------------------------------------
platforms:
  claude:
    model: "claude-sonnet-4-20250514"
    temperature: 0.1
    tools:
      - "read_file"
      - "glob"
      - "grep"

  ollama:
    model: "llama3.2"
    parameters:
      temperature: 0.1

# ----------------------------------------------------------------------------
# VALIDATION
# ----------------------------------------------------------------------------
validation:
  tests:
    - name: "Detects broken link"
      input: "[test](./nonexistent.md)"
      expected_contains:
        - "does not exist"
        - "broken"

    - name: "Validates existing link"
      input: "[README](../../README.md)"
      expected_contains:
        - "OK"
        - "valid"

    - name: "Detects missing category in path"
      input: |
        # From prompts/en/metaprompts/foo/README.md
        [bar](../../bar/bar.md)
      expected_contains:
        - "prompts/en/bar/bar.md"
        - "does not exist"
        - "missing category"

    - name: "Detects too many ../ segments"
      input: |
        # From prompts/en/metaprompts/foo/README.md
        # Link should be ../bar/bar.md not ../../bar/bar.md
        [bar](../../bar/bar.md)
      expected_contains:
        - "skips"
        - "metaprompts"

# ----------------------------------------------------------------------------
# METADATA
# ----------------------------------------------------------------------------
meta:
  changelog:
    - version: "1.1.0"
      date: "2026-01-31"
      changes:
        - "Added step-by-step path resolution instructions"
        - "Added common errors detection (missing category, too many ../)"
        - "Added tests for missing category and ../ count errors"
        - "Stricter constraints for path verification"
    - version: "1.0.0"
      date: "2026-01-31"
      changes:
        - "Initial version with markdown link validation"
        - "Cross-language link checking for prompts"
        - "Related prompts validation"
  related_skills:
    - "prompt-validator"
    - "translator"
    - "workflow-orchestrator"
  documentation: "docs/en/skills/link-checker.md"
